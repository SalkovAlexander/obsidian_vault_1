---
tags: 
alliaces:
---
2025-05-12
21:38
***
# Untitled 1
***
### О работе, ее структура и суть
Выпускная квалификационная работа представляет собой набор из трех инструментов и набора генераторов которые были созданы для проекта в объективе и позволили ускорить процесс разработки графического наполнения для проекта "В объективе", при этом как инструменты так и генераторы не лишены самостоятельности и могут быть использованы в отрыве от конкретного проекта.
Первый инструмент это главный шейдер игры, он определяет вид практически всех предметов на экране. Шейдер использует палитру в которой хранятся наборы цветов а также настройки для каждого материала.
Второй инструмент это редактор палитры, он позволяет менять цвет любого объекта в игре а также различные свойства материала.
Третий инструменты представляет собой программу, которая позволяет получить прямой доступ из окна Unity к генераторам, созданным внутри Blender, программа состоит из двух компонентов, первый из компонентов - blender дополнение, второй - unity модуль. Вместе они образуют единую информационную систему которой было дано название Bledner engine.
Также был создан набор процедурных генераторов внутри bledner с использованием blender geometry nodes, каждый из этих генераторов используется в проекте "В объективе" для создания наполнения игрового мира.
Таким образом созданный набор решений позволяет реализовать эффективный конвейер по производству графического наполнения проекта


### Процедурная генерация 3д моделей, генератор, примеры в индустрии
При разработке игр возникает необходимость создавать графические ассеты. Они могут включать в себя растровые и векторные изображения, анимации и 3д модели.
3Д модели делятся на несколько типов по своему назначению. Самый базовый тип 3д модели это пропс. Пропс представляет собой предмет в игровом мире, используется
преимущественно как декорация в игровом мире, также может быть игровым объектом, то есть игрок может взаимодействоватьс пропсом.К пропсам можно отнести камни, бочки,
бутылки, мебель и так далее. Следующий тип моделей это транспорт, он может быть как статичным так и с возможностью управления игроком. Еще один тип зд моделей это 
оружие, как правило оружие дается игроку и его противникам для создания возможности сражаться в играх, где это продиктовано геймдизайном. Персонажи - тоже 3д модели,
игрок зачастую сам обладает 3д моделью, которая отображает его игрового персонажа, так же у каждого противника, сожзника или неигрового персонажа есть своя 3д модель.
Здания также можно отнести к отдельному типу 3д моделей. Самые же большие 3д модели на экране у игрока - 3д модели окруженя, к ним можно отнести модель по которой 
передвигается игрок - земля, пол, асфальт, плитка, песок, небо так же является 3д моделью на которую проецируется текстурная карта неба.
Получается, что в игре, использующей 3д графику практивески все экранное пространство занято 3д моделями разного типа, они образуют игровой мир вокруг игрока, даже
элементы интерфейса в играх сосоят из 3д полигонов на которые наложен материал, который позволяет видеокарте рендерить эту геометрию как элемент интерфейса.
3д моделей даже в небольшой инди игре может быть огромное количество, и каждую такую модель нужно создать или где-то взять. Хорошо, если проект позволяет просто 
купить модель или получить бесплатно и использовать, но что если такой возможности нет. В таком случае 3д моедель нужно создать. Процесс создания 3д моделей 
называется 3д моделированием, и выплняется 3д художниками различных специализаций, в зависимости от того, какую модель нужно создать. В большенстве случаев процесс 
создания 3д моделей требует много ручного труда художника, но есть случаи, когда количество ручного труда можно значительно сократить прибегнув к помощи процедурного
моделирования.
Процедурное моделирование это процесс создания 3д модели путем выполнения программы с определенными входными параметрами. Можно ли сказать, что весь 3д контент можно
создать методами процедурного моделирования? Нет, процедурное моделирование подходит далеко не для всех случаем. Если вам нужен унакальный персонаж или строение, животное,
предмет или оружие, то выгоднее по затратам сил и времени прибегнуть к традиционному ручному моделированию, но вот если ваша задача - сделать модульный конструктор зданий,
множество похожих 3д ассетов но с разными параметрами, ассет который должен подстраиваться под окружающую его геометрию, тогда процедурное моделирование это правильный выбор, который сэкономит много ресурсов. 
Почему же процедурное моделирование для создания чего-то уникального не подходит а для создания похожих ассетов с отличающимися параметрами наоборот подходит? Дело в том, что в процессе создания генератора(инструмент при помощи которого создается процедурная модель) воспроизводится цепочка операций, которые может выполнить программа и которая приведет к появлению на выходе 3д модели. Этот процесс фактически является программированием. Так же как в процессе программирования создаются программа которая решает определенную задачу, так и в процессе создания инструмента процедурного моедлирования создается программа которая воспроизводит одну модель, но как и в любой другой программе, на результат влияет набор параметров.
Создание инструмента который будет создавать модель X практически всегда более трудоемкий процесс чем создание модели X традиционными методами, именно поэтому генератор создается так, чтобы он мог принимать различные параметры, что позволит ему создавать множество Xобразных моделей но с разными параметрами, что и делает использование данного метода получение моделей выгодным.
Получается, можно создать генератор и использовать его для создания 3д графики в играх, но какие именно модели можно создать таким способом. Чаще всего процедурное моделирование используют для трех типов моделей, для моделей окружения, для пропсов и для зданий. Например, для аркадной игры в жанре гонка нужно создать определенное количество гоночных трасс, при этом трассы походи, различаются лишь совей формой, шириной и длинной. Конечно, можно сделать все эти трассы вручную, но что если их не 2 а 10? В этом случае есть немалый смысл прибегнуть к процедурному моделированию и создать генератор, который будет в качестве параметров принимать небольшой сегмент трассы, значение ширины
трассы и кривую, которая будет описывать форму. Тогда после создания генератора можно будет создать один сегмент, и 10 разных кривых которые будут описывать форму трассы и при помощи инструмента процедурного моделирования, используя входные параметры, создать 10 трасс различной формы и длины. Это лишь один из бесчисленного множества пример использования
процедурного моделирования. Даже целые миры могут быть практически полностью быть сгенерированы процедурно, например в игре Minecraft создание миров происходит путем смешения различных шумов и параметров а также заранее созданных структур. При этом мир не создается полностью, а генерируется частями по мере продвижения по нему игрока. Создание одного мира Minecraft вручную заняло бы у человек не один год.


### Инструментарий для создания генераторов
Создание инструмента процедурного моделирования (генератора) также требует использование какого-то инструмента. Самый абстрактно простой способ это использовать язык программирования,
такой как C, Pyhon, Java или любой другой язык который позволяет интегрировать процедурное создание моделей в рабочий процесс. Например, если в качестве игрового движка используется Unity, то можно использовать стандартный для Unity язык C# для создания генератора. Использование языка программирования общего назначения для создание инструмента для процедурного моделирования позволит сделать инструмент подходящий для задачи, которую нужно решить. Однако такой подход значительно усложняет задачу, так как языки общего назначения не обладают нужным для создания генераторов 3д контента уровнем абстракции, хоть и позволяют максимально гибко выполнять задачу. Для облегчения задачи создания генераторов 3д контента для игр существуют специализированные решения. На данный момент самыми популярными из них являются Houdini, система Geometry nodes в Blender 3D.
Houdini и система Geometry nodes в Blender 3D предлагают широкий функционал, позволяющий создавать инструменты процедурного создания 3д графики для инг любой сложности.
### Описание процесса создания генераторов в Blender и Houdini
Процесс строится на составлении последовательностей команд для операций над данными в результате которых получаются 3д модели. Как Blender так и Houdini предлагают создавать
генераторы из нод. Нода - структурный элемент генератора, выполняющий одну или несколько операций с данными, у ноды как правило есть вход или входы, параметры и выход или выходы.
Если в Bledner набор нод определен разработчиками, то Houdini позволяет создавать собственные ноды используя язык программирования vex.
![[Pasted image 20250512214239.png]]
Вот так выглядит набор нод в Blender geometry nodes который позволяет создавать 3д модель текста. Разберем структуру генератора.
Под номером 1 нода которая позволяет получить доступ ко всем входным параметрам генератора.
Номером 2 обозначена нода которая создает силуэты букв из кривых, эта нода принимает в качестве строки текста и размера текста параметры, к которым позволяет получить доступ нода под номером 1.
Затем данные передаются в ноду под номером 3 которая в качестве входных данных принимает кривые из ноды 2 и параметр разрешения ресемплинга.
После ресемплинга кривые преобразуются в полигональную 3д модель без объема при помощи ноды 4.
После преобразования в полигональную 3д модель без объема нода 5, 6, 7 и 8 придают объем модели используя параметр толщины.
Потом ноды 9, 10 и 11 позиционируют получившуюся 3д модель так, чтобы она находилась в нулевой позиции в  системе координат.
![[Pasted image 20250512215816.png]]
На рисунку представлен пошаговый процесс генерации 3д модели по шагам.
![[Pasted image 20250512220358.png]]
Поскольку используется процедурный подход создания 3д модели, можно менять параметры 3д модели, изменяя входные параметры генератора как показано на рисунке.
![[Pasted image 20250512222032.png]]
На рисунке можно увидеть как аналогичный генератор будет выглядеть если его создать средствами Houdini.
Как можно заметить, в houdini при создании генератора было задействовано меньше нод, связано это с тем, что houdini предлагает больший набор нод и их параметров.
**Привести еще примеры того что можно делить при помощи генераторов**
Использование инструментов, таких как Blender Geometry Nodes и houdini сильно упрощает и ускоряет процесс создания генераторов и как следствие ассетов для игровых проектов. Процесс создания процедурного 3д контента в током случае выглядит следующим образом: 
В программе Bledner 3D или Houdini техническим художником создается генератор путем создания цепочек из нод, которые отвечают за генерацию 3д модели
Затем с использование различных параметров генерируется набор из необходимых 3д моделей при помощи созданного генератора
Созданные модели экспортируются из Blender или Houdini в необходимом формате
Затем модели импортируются в игровой движок, например Unity, настраиваются в нем и используются по назначению
Как можно заметить процесс включает в себя создание 3д моделей внутри программ Bledner и Houdini, последующий экспорт и импорт этих моделей в игровой движок, все эти операции отнимают достаточно много времени у разработчиков а так же делают необходимым постоянное использование Houdini и Blender для создания новых моделей или внесения корректировок в созданные ранее. Также все эти шаги делают итеррирование над моделью сложным и не позволяют легко подобрать нужные параметры для генератора опираясь например на то, где в мире располагается 3д модель которую нужно сгенирировать.
### Houdini engine

### Интеграция в Unity(почему использовали unity)
Генераторы представляют собой мощный инструмент который позволяет ускорить и облегчить процесс разработки, однако пока мы рассматривали использование генераторов только внутри программного обеспечения в котором эти генераторы были созданы. Но есть и другой способ взаимодействовать с генераторами - напрямую из игрового движка, без необходимости переключаться в Houdini или Blender. Это особенно актуально потому что зачастую создание генератора и его использование это отдельный процессы которые происходят в разное время и могут выполняться разными людьми.
#### Существующее решение Houdini engine
Мы рассмотрели две программы которые позволяют создавать генераторы, Houdini и Blender, у Houdini существует интеграция с игровыми движками и пакетами для 3д моделирования под названием Houdini Engine. 
Houdini Engine представляет собой модуль внутри houdini а также набор дополнений для Unity, Unreal engine, Maya, 3Ds max.

Вот как описывает свой продукт Side Effects, разработчики  Houdini и его интеграции в другое ПО Houdini engine:
> Houdini Engine предлагает процедурный подход к созданию игрового контента на основе узлов. Создайте сети, определяющие рецепт, который можно применять снова и снова, а затем оберните их для создания пользовательских смарт-активов. Поделитесь этими активами с коллегами, которые смогут загрузить их
> непосредственно в игровые редакторы, такие как Unreal® или Unity,® 3D-приложения, такие как Autodesk® Maya® или 3ds Max® или собственные игровые редакторы.
> 
> В Houdini
> В Houdini все, что вы делаете, создает узел. Эти узлы объединяются в сети, которые определяют поток данных, что позволяет вам легко вернуться назад и внести изменения. Сети также могут быть инкапсулированы в отдельные узлы, называемые
> Houdini Digital Assets, которые позволяют вам делиться своими методами с
> коллегами. Эти ==ассеты== предоставляют инструменты, созданные художником, которые могут создать основу процедурного игрового конвейера.
> В ВАШЕМ РЕДАКТОРЕ ИГРЫ
> Houdini Engine позволяет загружать эти Houdini Digital Assets в ваш игровой редактор. Любые параметры добавленные к ассету, доступны для редактирования, а ==гизмо== могут быть установлены в окне редактора для интерактивного управления. Один ассет может быть использоваться несколько раз в одном уровне или в нескольких уровнях. Изменения, внесенные в основной ассет, даже в глубине производства, обновят все ==инстансы== ассета.

![[Screenshot_1.translated.jpg]]
На рисунке показана схема работы Houdini engine 

#### Обзор возможностей houdini engine для unity
![[Pasted image 20250518154236.png]]
На рисунке показано основное меню Houdini engine. Меню предоставляет доступ к настройкам и основным функциям интеграции. Пункт plugin settingss открывает окно с настройками houdini engine, таким как путь к houdini, настройки импорта и экспорта моделей, информации об адресе для связи с Houdini. Пункт session позволяет создать или подключиться к сессии houdini. Основным пунктом является Load file, который позволяет загрузить в сцену unity HDA -  генератор созданный в houdini. 
![[Pasted image 20250518155314.png]]
После загрузки генератора из Houdini в сцене появляется структура из объектов показанная на рисунке.
Родительский объект это контейнер в котом находятся HDA data - параметры генератора и сгенерированная 3д модель. 
![[Pasted image 20250518155536.png]]
Если выбрать контейнер, то мы получим доступ к функциям генерации модели(GENERATE), параметрам генератора (ASSER PARAMETERS), входным нодам(INPUT NODES) и функциям сохранения и обновления сгенерированной 3д модели(BAKE).
Работа с Houdini engine выглядит следующим образом, в houdini создается и сохраняется генератор - HDA, затем он импортируется в unity, в меню импортированного генератора настраиваются его параметры, затем эти параметры передаются в houdini на обработку и после обработки результат возвращается в unity. Кода модель сгенерирована из нее можно сделать prefab, сохранить на диске в дириктории проекта.

## Проектирование собственного решения Blender engine
### Требования к решению
Прежде всего нам необходимо сделать интеграцию bledner с unity, поэтому решение должно представлять собой два модуля, один для blender, второй для unity
Должен быть реализован основой функционал - использование генераторов созданных при помощи bledner geometry nodes внутри unity
Необходимо реализовать поддержку основных необходимых типов параметров, таких как int, float, string, vector, boolean, curve и mesh.

Было принято решение делать инструмент состоящим из трех частей:
1) основной шейдер игры, используется практически на всех объектах в игре, в качестве входных параметров использует палитру, которая представляет собой изображение с информацией о цветах объекта а также о свойствах его поверхности, в одной палитре записана информация для всех объектов
2) редатор палитры который позволяет в редакторе unity редактировать палитру
3) инструмент для интеграции bledner geometry nodes с Unity, который позволяет использовать созданные в blender генераторы внутри редактора unity, состоит из модуля для bledner и модуля для unity которые коммуницируют и вместе образуют единый инструмент.
4) набор созданных при помощи bledner geometry nodes  генераторов, которые используются для генерации 3д контента для игрового проекта 

Все эти модули взаимосвязаны, вместе они работают следующим образом
Создаются необходимые генераторы в geometry nodes, сохраняются в файл(модуль 4), при помощи инструмента(модуль 3) внутри unity генерируются нудные 3д модели, после этого на них назначается шейдер (модуль 1) и после в редакторе палитры(модуль 2) настраиваются свойства материалов.

## Реализация

***
###### Zero-Links
-
***
###### Links
-